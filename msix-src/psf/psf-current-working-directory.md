---
description: Платформа поддержки пакетов помогает работать с рабочим каталогом.
title: Текущий рабочий каталог платформы поддержки пакетов
ms.date: 05/14/2020
ms.topic: article
keywords: Windows 10, UWP, msix, ПСФ
ms.localizationpriority: medium
ms.custom: RS5
ms.openlocfilehash: 8ef43fa5464fe8e3b6a6f264c8edf25d7fdb6bff
ms.sourcegitcommit: 6b1ec6420dbaa327b65c208b4cd00da87985104b
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 08/29/2020
ms.locfileid: "89090712"
---
# <a name="current-working-directory-psf"></a>Платформа поддержки пакетов текущего рабочего каталога
Платформа поддержки пакетов использует config.jsв файле для настройки поведения приложения.

## <a name="proceedure"></a>Процедуры
Чтобы настроить выполнение приложения для получения значений параметров, переданных в него во время запуска приложения, необходимо выполнить следующие действия. 

1. Загрузка платформы поддержки пакетов
1. Настройка платформы поддержки пакетов (config.jsна)
1. Вставка файлов платформы поддержки пакетов в пакет приложения
1. Обновление манифеста приложения
1. Повторно упаковать приложение

## <a name="download-the-package-support-framework"></a>Загрузка платформы поддержки пакетов
Платформу поддержки пакетов можно получить с помощью автономного средства командной строки NuGet или с помощью Visual Studio.

### <a name="nuget-comandline-tool"></a>Средство командлине NuGet:
Установите средство командной строки NuGet с веб-сайта NuGet: [https://www.nuget.org/downloads](https://www.nuget.org/downloads) . После установки запустите следующую командную строку в окне администрирования PowerShell.

``` powershell
nuget install Microsoft.PackageSupportFramework
```

### <a name="visual-studio"></a>Visual Studio.
В Visual Studio щелкните правой кнопкой мыши узел решения или проекта и выберите одну из команд Управление пакетами NuGet. Найдите **Microsoft. паккажесуппортфрамеворк** или **ПСФ** , чтобы найти пакет на NuGet.org. Затем установите его.


## <a name="create-the-configjson-file"></a>Создание config.jsдля файла

Чтобы указать аргументы, необходимые для запуска приложения, необходимо изменить config.jsв файле, указав исполняемый файл приложения, и параметры. Перед настройкой config.jsв файле ознакомьтесь со следующей таблицей, чтобы получить представление о JSON струкутуре.

### <a name="json-schema"></a>Схема JSON

|Array          | ключ               | Значение  |
|---------------|-------------------|--------|
| веб-масштабированием;  | идентификатор                | Используйте значение атрибута ID элемента Application в манифесте пакета.|
| веб-масштабированием;  | исполняемый файл        | Относительный путь пакета к исполняемому файлу, который необходимо запустить. Это значение атрибута Executable элемента Application. |
| веб-масштабированием;  | аргументы         | Используемых Аргументы параметра командной строки для исполняемого файла. |
| веб-масштабированием;  | workingDirectory  | Используемых Путь относительно пакета, используемый в качестве рабочего каталога запускаемого приложения. Если это значение не задано, операционная система использует каталог System32 в качестве рабочего каталога приложения. Если указать значение в виде пустой строки, будет использоваться каталог исполняемого файла, на который указывает ссылка. |
| веб-масштабированием;  | monitor           | Используемых При наличии монитор определяет дополнительную программу, которая должна быть запущена перед запуском основного приложения. |
| процессы     | исполняемый файл        | В большинстве случаев это будет имя исполняемого файла, настроенного выше, с удаленным путем и расширением файла. |
| исправлений        | Файл DLL.               | Используемых Относительный путь пакета к адресной привязке,. msix/. appx для загрузки. |
| исправлений        | config            | Используемых Определяет, как ведет себя адресная привязка DL. Точный формат этого значения зависит от способа исправления, так как каждая адресная привязка может интерпретировать этот «большой двоичный объект».|

Ключи приложений, процессов и исправлений являются массивами. Это означает, что вы можете использовать config.jsв файле, чтобы указать более одного DLL приложения, процесса и адресной привязки.

Запись в процессах имеет значение Executable, значение, которое должно быть сформировано как строка регулярного выражения, чтобы соответствовать имени исполняемого процесса без пути или расширения файла. Средство запуска Windows SDK ожидает синтаксис Екмалист std:: Library RegEx для строки RegEx.

``` json
{
    "applications": [
        {
            "id": "PSFSample",
            "executable": "PSFSampleApp/PrimaryApp.exe",
            "workingDirectory": "PSFSampleApp/"
        }
    ],
    "processes": [
        {
            "executable": "PSFSample"
        }
    ]
}
```

В приведенном выше примере config.jsв файле, PrimaryApp.exe будет иметь рабочий каталог, перенаправленный в каталог *псфсамплеапп* .


## <a name="inject-the-package-support-framework-files-to-the-application-package"></a>Вставка файлов платформы поддержки пакетов в пакет приложения

### <a name="create-the-package-staging-folder"></a>Создание промежуточной папки пакета
Если у вас уже есть файл. msix (или. appx), его содержимое можно распаковать в папку макета, которая будет служить промежуточной областью для пакета. Это можно сделать из командной строки с помощью средства программе makeappx.

Средство программе makeappx можно найти в расположении по умолчанию:

| Архитектура ОС | Каталог                                                   |
|-----------------|-------------------------------------------------------------|
| Windows 10 x86  | C:\Program Files\Windows Kits\10\bin \[ **version**] \x86\makeappx.exe       |
| Windows 10 x64  | C:\Program Files (x86) \Windows Kits\10\bin \[ **version**] \x64\makeappx.exe |

```powershell
makeappx unpack /p PrimaryApp.msix /d PackageContents
```

Приведенная выше команда PowerShell экспортирует содержимое приложения в локальный каталог.

### <a name="inject-required-files"></a>Вставка необходимых файлов
Добавьте требуемые 32-разрядные и 64-разрядные версии пакетов DLL и исполняемые файлы в каталог пакета. Используйте приведенную ниже таблицу в качестве рекомендации, а также включите все необходимые исправления среды выполнения. Сведения об использовании платформы поддержки пакетов для исправления среды выполнения см. в статье документация по устранению неполадок в документации по [пакетной поддержке](./package-support-framework.md) .

| Исполняемый файл приложения — x64 | Исполняемый файл приложения — x86     |
|-------------------------------|-----------------------------------|
| PSFLauncher64.exe             | PSFLauncher32.exe                 |
| PSFRuntime64.dll              | PSFLauncher32.dll                 |
| PSFRunDll64.exe               | PSFRunDll32.exe                   |

Указанные выше файлы, а также **config.jsв** файле должны размещаться в корне каталога пакета приложения. Эти файлы можно найти в каталоге, в котором находится платформа поддержки установленных пакетов, в каталоге **bin** .


## <a name="update-the-applications-manifest"></a>Обновление манифеста приложения
Откройте манифест приложения в текстовом редакторе, а затем задайте атрибуту Executable элемента Application имя исполняемого файла Псфлаунчер. Если вы знакомы с архитектурой целевого приложения, выберите соответствующую версию, Псфлаунчер [x64/x86]. exe. Если неизвестно, PSFLauncher32.exe будет работать во всех случаях.

```xml
<Package ...>
  ...
  <Applications>
    <Application Id="PSFSample"
                 Executable="PSFLauncher32.exe"
                 EntryPoint="Windows.FullTrustApplication">
      ...
    </Application>
  </Applications>
</Package>
```


## <a name="re-package-the-application"></a>Повторно упаковать приложение
Повторно упакуйте приложение с помощью средства программе makeappx. См. Следующий пример того, как упаковать и подписать приложение с помощью PowerShell:

``` powershell
makeappx pack /d PackageContents /p PSFSamplePackageFixup.msix
signtool sign /a/v/fd sha256 /f ExportedSigningCertificate.pfx PSFSamplePackageFixup.msix
```