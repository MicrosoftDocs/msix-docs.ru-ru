---
title: Создание пакета MSIX с MSIX Core из исходного кода
description: Описание процесса создания пакета MSIX из исходного кода с помощью MSIX Core.
ms.date: 12/19/2019
ms.topic: article
keywords: Windows 10, Windows 7, Windows 8, Windows Server, UWP, msix, мсикскоре, 1709, 1703, 1607, 1511, 1507
ms.localizationpriority: medium
ms.custom: RS5, seodec18
ms.openlocfilehash: 349eb1e99a752d56126936dde5517050fae9f090
ms.sourcegitcommit: 0412ba69187ce791c16313d0109a5d896141d44c
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 12/20/2019
ms.locfileid: "75303333"
---
# <a name="create-an-msix-package-with-msix-core-from-source-code"></a>Создание пакета MSIX с MSIX Core из исходного кода

[MSIX Core](msixcore.md) предоставляет развертывание MSIX для выбора предыдущих версий Windows. Для создания приложения с помощью ClickOnce можно использовать установщик MSIX Core. Это позволит пользователям скачивать файл Setup. exe и устанавливать приложение MSIX с помощью установщика MSIX Core.

## <a name="host-your-app-on-a-web-server"></a>Размещение приложения на веб-сервере

Чтобы подготовить приложение к начальной загрузке с помощью установщика MSIX Core, необходимо разместить пакет приложения на веб-сервере. В этом разделе содержатся сведения о настройке веб-приложения в [Azure](#azure), [службы IIS (IIS)](#internet-information-services-iis)и [Amazon Web Services (AWS)](#amazon-web-services-aws).

### <a name="azure"></a>Azure

Чтобы использовать этот параметр, необходимо иметь подписку Azure. Чтобы получить его, см. [страницу учетной записи Azure](https://azure.microsoft.com/free/).

#### <a name="create-an-azure-web-app"></a>Создание веб-приложения Azure

Чтобы начать работу, перейдите на [страницу портал Azure](https://portal.azure.com/) и выполните следующие действия.

1. Щелкните **создать ресурс**.
2. Щелкните **веб** и выберите **веб-приложение**.
3. В разделе **сведения об экземпляре**Создайте уникальное имя приложения и выберите соответствующие параметры для приложения. Например, необходимо выбрать между **кодом или контейнером DOCKER** и **стеком времени выполнения**. В противном случае оставьте все остальное по умолчанию.
4. Нажмите кнопку **создать** и завершите работу мастера.

#### <a name="host-the-app-package-and-the-web-page"></a>Размещение пакета приложения и веб-страницы

1. После создания веб-приложения выберите приложение.
2. В разделе **средства разработки**щелкните **редактор службы приложений**.
3. В редакторе имеется файл **хостингстарт. HTML** по умолчанию. Щелкните правой кнопкой мыши пустое пространство в проводнике и выберите команду " **отправить файлы** ", чтобы начать отправку пакетов приложений.
4. Снова щелкните правой кнопкой мыши пустое пространство на панели проводника файлов и выберите пункт **создать файлы** , чтобы создать новый файл. Присвойте файлу имя, которое требуется использовать в качестве страницы HTML по умолчанию.

#### <a name="configure-the-web-app-for-app-package-mime-types"></a>Настройка веб-приложения для типов MIME для пакета приложения

Добавьте в веб-приложение новый файл с именем Web. config. Откройте файл Web. config и добавьте следующий код XML в файл.

```xml
<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <system.webServer>
    <!--This is to allow the web server to serve resources with the appropriate file extensions-->
    <staticContent>
      <mimeMap fileExtension=".appx" mimeType="application/appx" />
      <mimeMap fileExtension=".msix" mimeType="application/msix" />
    </staticContent>
  </system.webServer>
</configuration>
```

### <a name="internet-information-services-iis"></a>служба Internet Information Services (IIS)

IIS — это необязательная функция Windows. Чтобы установить IIS, выполните следующие действия.

1. Нажмите кнопку **Пуск** и выполните поиск по запросу **Включение или отключение компонентов Windows**.
2. Выберите **службы IIS**. 
3. Также убедитесь, что установлен **ASP.NET 4,5** или более поздней версии. В диалоговом окне **компоненты Windows** разверните **службы IIS** -> **службы** Интернета -> **функции разработки приложений**и выберите версию **ASP.NET** , которая больше или равна **ASP.NET 4,5**.
4. Нажмите кнопку **ОК** , чтобы начать установку.

Требуется Visual Studio 2017 (или более поздняя версия) и средства веб-разработки. Если у вас уже установлена Visual Studio 2017 или более поздняя версия, убедитесь, что установлены рабочие нагрузки ASP.NET и Web Development. В противном случае установите Visual Studio [отсюда](https://docs.microsoft.com/visualstudio/install/install-visual-studio).

#### <a name="build-a-web-app"></a>Создание веб-приложения

Запустите Visual Studio от имени администратора и создайте новый проект **визуального C# веб-приложения** с пустым шаблоном проекта.

#### <a name="configure-iis-with-your-web-app"></a>Настройка служб IIS с помощью веб-приложения

1. В **Обозреватель решений**щелкните правой кнопкой мыши корневой проект и выберите пункт **свойства**. 
2. В окне "Свойства" перейдите на вкладку " **веб** ". 
3. В разделе **серверы** выберите пункт **локальные службы IIS** в раскрывающемся меню и щелкните **создать виртуальный каталог**.

#### <a name="add-the-app-package-to-the-web-application"></a>Добавление пакета приложения в веб-приложение

Добавьте пакет приложения, который требуется распространить в веб-приложение:

1. В **Обозреватель решений**щелкните правой кнопкой мыши узел проекта.
2. Выберите **добавить** -> **создать папку** и назовите папку **packages**. 
3. Чтобы добавить пакеты приложений в папку, щелкните правой кнопкой мыши папку пакеты и выберите **добавить** -> **существующий элемент**. Перейдите к расположению пакета приложения.

#### <a name="create-a-web-page"></a>Создание веб-страницы

Создайте страницу HTML или любое другое веб-приложение в соответствии с вашими потребностями. Добавьте ссылку на новый файл Setup. exe.

#### <a name="configure-the-web-app-for-app-package-mime-types"></a>Настройка веб-приложения для типов MIME для пакета приложения

Откройте файл **Web. config** в обозревателе решений и добавьте следующий код XML в элемент <configuration>.

```xml
<system.webServer>
  <!--This is to allow the web server to serve resources with the appropriate file extensions-->
  <staticContent>
    <mimeMap fileExtension=".appx" mimeType="application/appx" />
    <mimeMap fileExtension=".msix" mimeType="application/msix" />
  </staticContent>
</system.webServer>
```

### <a name="amazon-web-services-aws"></a>Amazon Web Services (AWS)

Чтобы использовать этот параметр, необходимо иметь членство в AWS. Дополнительные сведения см. в разделе [AWS Account Details](https://aws.amazon.com/free/).

#### <a name="create-an-amazon-s3-bucket-and-upload-your-msix-packages-and-web-pages"></a>Создание контейнера Amazon S3 и отправка пакетов MSIX и веб-страниц

Amazon Simple Storage Service (S3) — это AWS предложение для сбора, хранения и анализа данных. Контейнеры S3 — это удобный способ размещения пакетов приложений Windows 10 и веб-страниц для распространения.

1. Войдите в AWS. В разделе **службы** найдите **S3**.
2. Выберите **создать контейнер** и введите **имя контейнера** для веб-сайта. Следуйте указаниям диалогового окна, чтобы задать свойства и разрешения. Чтобы обеспечить возможность распространения приложения Windows 10 с веб-сайта, включите разрешения на **Чтение** и **запись** для контейнера и выберите **предоставить общий доступ на чтение этому контейнеру**. Щелкните **создать контейнер** , чтобы завершить этот шаг.
3. По завершении отправьте пакеты MSIX и веб-страницы в контейнер S3.

#### <a name="configure-the-web-app-for-app-package-mime-types"></a>Настройка веб-приложения для типов MIME для пакета приложения

Использование интерфейса веб-службы, такого как [браузер S3](https://s3browser.com/features-content-mime-types-editor.aspx) , для добавления новых **заголовков HTTP по умолчанию**.

1. Перейдите к пункту **инструменты** и выберите **заголовки HTTP по умолчанию**.
2. В диалоговом окне **заголовки HTTP по умолчанию** нажмите кнопку **Добавить**.
3. В диалоговом окне **Добавление новых заголовков HTTP по умолчанию** укажите имя контейнера, имя файла, имя заголовка и значение заголовка, а затем нажмите кнопку **Добавить новый заголовок**.
    * **Имя контейнера**: msix-Packages
    * **Имя файла**: *. msix
    * **Имя заголовка**: Content-Type
    * **Значение заголовка**: Application/msix

> [!NOTE]
> AWS имеют некоторые строгие рекомендации, которые необходимо выполнить. Например, имена контейнеров должны быть уникальными, поэтому при использовании приведенного выше примера необходимо изменить имя контейнера.

## <a name="use-the-msix-core-installer-to-build-the-clickonce-application"></a>Создание приложения ClickOnce с помощью установщика MSIX Core

Найдите приложение ClickOnce Setup. exe приложения.

### <a name="run-url-command-to-create-new-setupexe"></a>Команда запуска URL-адреса для создания нового файла Setup. exe

Убедитесь, что выполнены инструкции по клонированию, созданию и публикации решения MSIX Core в Visual Studio.

Перейдите в каталог, в который загружен файл Setup. exe, и выполните следующую команду:

```PowerShell
setup-exe - url=<location of your msix in the webservice>
```

### <a name="sign-the-application"></a>Подписать приложение

Поскольку на предыдущем шаге был создан новый файл Setup. exe, необходимо снова подписать приложение, чтобы убедиться, что вы являетесь доверенным издателем приложения и установили целостность приложения. Вы можете использовать средство [SignTool](https://docs.microsoft.com/dotnet/framework/tools/signtool-exe) и предоставить свой сертификат.

### <a name="distribute-the-application-to-your-users"></a>Распространение приложения для пользователей

Теперь вы можете указать на новый файл Setup. exe с кнопкой "ссылка" или "Скачать" на своем веб-сайте. MSIX Core нацелен на пользователей в Windows 10, версии 1703 и более ранних. [Установщик приложений](https://docs.microsoft.com/windows/msix/app-installer/installing-windows10-apps-web) — это идеальный процесс установки для пакетов MSIX в Windows 1709 или более поздней версии. Установщик приложений оптимизирует место на диске на стороне потребителя и может напрямую устанавливать приложения из расположений HTTP. MSIX Core определит, находится ли потребитель в Windows 1709 или более поздней версии и перенаправит его в установщик приложения. 

В Microsoft ребро можно вызвать метод [жесостенвиронментвалуе ()](https://docs.microsoft.com/previous-versions/windows/internet-explorer/ie-developer/platform-apis/mt795399%28v%3dvs.85%29) , и в поле " *Сборка ОС* " в возвращаемом значении будет указана версия ОС пользователя. После этого можно запросить процесс установки для использования MSIX Core (для Windows 10, версии 1703 и более ранних версий) или установщика приложений (для Windows 10, версии 1709 и более поздних версий).

## <a name="user-experience"></a>раздел "Взаимодействие с пользователем"

Пользователи просто загружают и запускают файл Setup. exe с веб-страницы разработчика.

* Если установщик MSIX Core еще не установлен, когда пользователь запускает Setup. exe, он видит приглашение ClickOnce, а затем настраивается на **установку, чтобы установить** установщик MSIX Core. Установщик автоматически запускает и отображает экран установки для пакета MSIX, указанного в строке запроса разработчика, чтобы пользователи могли установить приложение.
* Если установщик MSIX Core уже установлен, когда пользователь запускает Setup. exe, то установщик MSIX Core автоматически запускает и отображает экран установки пакета MSIX, указанного в строке запроса, чтобы пользователи могли установить приложение.
