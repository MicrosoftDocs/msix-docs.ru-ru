---
Description: В этом руководство объясняется, как настроить решение Visual Studio для оптимизации двоичных файлов приложения с помощью образов в машинном коде.
title: Оптимизация классических приложений .NET с помощью образов в машинном коде
ms.date: 07/29/2019
ms.topic: article
keywords: Компилятор образов в машинном образах Windows 10, UWP, msix
ms.localizationpriority: medium
ms.openlocfilehash: 1327a48d40576dc47eebd8c0bad6fc075dea23d4
ms.sourcegitcommit: f47c140e2eb410c2748be7912955f43e7adaa8f9
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 10/22/2019
ms.locfileid: "72776523"
---
# <a name="optimize-your-net-desktop-apps-with-native-images"></a>Оптимизация классических приложений .NET с помощью образов в машинном коде

Время запуска приложения .NET Framework можно увеличить путем предварительной компиляции двоичных файлов. Эту технологию можно использовать для больших приложений, которые упаковываются и распределяются по Microsoft Store. В некоторых случаях мы наблюдали повышение производительности на 20%. Дополнительные сведения об этой технологии см. в [техническом обзоре](https://github.com/dotnet/coreclr/blob/master/Documentation/botr/readytorun-overview.md).

Мы выпустили компилятор образов в машинном код как [пакет NuGet](https://www.nuget.org/packages/Microsoft.DotNet.Framework.NativeImageCompiler). Этот пакет можно применить к любому .NET Framework приложению, предназначенному для .NET Framework версии 4.6.2 или более поздней. Этот пакет добавляет шаг после сборки, который включает собственные полезные данные во все двоичные файлы, используемые приложением. Эти оптимизированные полезные данные будут загружены при запуске приложения в .NET 4.7.2 и более поздних версиях, в то время как предыдущие версии будут по-прежнему загружать код MSIL.

Платформа [.NET Framework 4.7.2](https://blogs.msdn.microsoft.com/dotnet/2018/04/30/announcing-the-net-framework-4-7-2/) включена в [Обновление Windows 10 от апреля 2018](https://blogs.windows.com/windowsexperience/2018/04/30/how-to-get-the-windows-10-april-2018-update/). Эту версию .NET Framework можно также установить на компьютерах под управлением Windows 7 и Windows Server 2008 R2 +.

> [!IMPORTANT]
> Если вы хотите создавать образы в машинном коде для приложения, упакованного проектом упаковки приложений Windows, обязательно установите для минимальной версии целевой платформы проекта обновление годовщины Windows.

## <a name="how-to-produce-native-images"></a>Как создавать образы в машинном код

Выполните эти инструкции, чтобы настроить проекты.

1. Настройте целевую платформу как 4.6.2 или выше.

2. Настройка целевой платформы как x86 или x64 

3. Добавьте пакеты NuGet.

4. Создайте сборку выпуска.

## <a name="configure-the-target-framework-as-462-or-above"></a>Настройте целевую платформу как 4.6.2 или выше.

Чтобы настроить проект для назначения .NET Framework 4.6.2, вам потребуются средства разработки .NET Framework 4.6.2 или более поздние версии. Эти средства доступны в установщике Visual Studio в качестве дополнительных компонентов в рабочей нагрузке Разработка классических приложений .NET.

![Установка средств разработки .NET 4.6.2](images/install-4.6.2-devpack.png)

Кроме того, можно получить пакеты разработчика .NET из: [https://www.microsoft.com/net/download/visual-studio-sdks](https://www.microsoft.com/net/download/visual-studio-sdks)

## <a name="configure-the-target-platform-as-x86-or-x64"></a>Настройка целевой платформы как x86 или x64

Компилятор образов в машинном коде оптимизирует код для данной платформы. Чтобы использовать его, необходимо настроить приложение для работы с одной конкретной платформой, например x86 или x64.

Если в решении имеется несколько проектов, то только проект точки входа (скорее всего, проект, создающий исполняемый файл) должен быть скомпилирован как x86 или x64. Дополнительные двоичные файлы, на которые ссылается основной проект, будут обрабатываться с архитектурой, указанной в основном проекте, даже если они компилируются как AnyCPU.

Чтобы настроить проект, выполните следующие действия.

1. Щелкните решение правой кнопкой мыши и выберите **Configuration Manager**.

2. Выберите **< создать. >** в раскрывающемся меню **платформа** рядом с именем проекта, который создает исполняемый файл.

3. В диалоговом окне **Создание платформы проекта** убедитесь, что для параметра **Копировать параметры из** раскрывающегося списка задано значение **любой ЦП**.

![Настройка x86](images/configure-x86.png)

Повторите этот шаг для `Release/x64`, если требуется создать двоичные файлы x64.

>[!IMPORTANT]
> Конфигурация AnyCPU не поддерживается компилятором образов в машинном код.

## <a name="add-the-nuget-packages"></a>Добавление пакетов NuGet

Компилятор образов в машинном код предоставляется как пакет NuGet, который необходимо добавить в проект Visual Studio, создающий исполняемый файл. Обычно это Windows Forms или проект WPF. Используйте эту команду PowerShell для этого.

```PS
PM> Install-Package Microsoft.DotNet.Framework.NativeImageCompiler -Version 1.0.0
```

## <a name="create-a-release-build"></a>Создание сборки выпуска

Пакет NuGet настраивает проект для запуска дополнительного средства для сборок выпуска. Это средство добавляет машинный код в те же двоичные файлы.
Чтобы убедиться, что средство обработало двоичные файлы, можно проверить выходные данные сборки, чтобы убедиться, что она содержит следующее сообщение:

```
Native image obj\x86\Release\\R2R\DesktopApp1.exe generated successfully.
```

Компиляцию образа в машинный код можно запустить в сборках, не относящихся к выпуску, задав для свойства `NgenR2R` значение `true` в файле проекта.

## <a name="faq"></a>Вопросы и ответы

**Вопрос. работают ли новые двоичные файлы на компьютерах без .NET Framework 4.7.2?**

А) Оптимизированные двоичные файлы помогут улучшить работу с .NET Framework 4.7.2. Клиенты, которые работают с предыдущими версиями .NET Framework, загружают неоптимизированный код MSIL из двоичного файла.

**Вопрос. как можно отправить отзыв или сообщить о проблемах?**

А) Сообщите о проблемах с помощью средства обратной связи в Visual Studio 2017. [Дополнительные сведения](https://docs.microsoft.com/visualstudio/ide/how-to-report-a-problem-with-visual-studio-2017).

**Вопрос. Каково влияние добавления собственного образа в существующие двоичные файлы?**

А) Оптимизированные двоичные файлы содержат управляемый и машинный код, что делает окончательные файлы более большими.

**Вопрос. можно ли освободить двоичные файлы с помощью этой технологии?**

А) Эта версия включает лицензию Go Live, которую можно использовать сегодня.
