---
Description: Запуск Desktop App Converter для упаковки классического приложения для Windows (например, Win32, WPF и Windows Forms).
title: Упаковка приложения с помощью Desktop App Converter (мост для классических приложений)
ms.date: 07/29/2019
ms.topic: article
keywords: windows 10, uwp
ms.assetid: 74c84eb6-4714-4e12-a658-09cb92b576e3
ms.localizationpriority: medium
ms.openlocfilehash: a83daf48568935822c8dde02d2f7e4328c094b23
ms.sourcegitcommit: 8a75eca405536c5f9f7c4fd35dd34c229be7fa3e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 07/31/2019
ms.locfileid: "68685331"
---
# <a name="package-a-desktop-application-using-the-desktop-app-converter"></a>Упаковка классического приложения с помощью конвертора классических приложений

> [!NOTE]
> Средство преобразования классических приложений не рекомендуется к использованию. Вместо этого рекомендуется использовать [инструмент упаковки MSIX](../packaging-tool/create-app-package-msi-vm.md) .

![Значок DAC](images/dac.png)

Средство преобразования классических приложений (DAC) создает пакеты для настольных приложений для интеграции с последними функциями Windows, включая распространение и обслуживание с помощью Microsoft Store. Сюда входят приложения Win32 и приложения, созданные с помощью .NET 4.6.1.

[Получить Desktop App Converter](https://aka.ms/converter)

Хотя в названии этого средства содержится термин "Преобразователь", на самом деле оно не преобразует ваше приложение. Приложение остается неизменным. Однако это средство создает пакет приложения для Windows с идентификатором пакета. Также преобразователь обеспечивает возможность осуществлять вызов разнообразных API WinRT.

Чтобы установить этот пакет на компьютер, на котором ведется разработка, можно использовать командлет Add-AppxPackage для PowerShell.

Преобразователь запустит классическую программу установки в изолированной среде Windows, используя чистый базовый образ, предоставляемый в составе скачиваемых файлов преобразователя. Он захватывает любые операции ввода-вывода реестра и файловой системы, инициализируемые классической программой установки, и упаковывает их в виде части выходных данных.

> [!IMPORTANT]
> Конвертер для классических приложений поддерживается в Windows 10, версии 1607 и более поздних версиях. Его можно использовать только в проектах, предназначенных для годовщины обновления Windows 10 (10,0; Сборка 14393) или более поздняя версия в Visual Studio.

## <a name="the-dac-does-more-than-just-generate-a-package-for-you"></a>DAC не просто создает для вас пакет.

Вот несколько дополнительных возможностей, предоставляемых DAC.

**Обновление Windows 10 для дизайнеров**

:heavy_check_mark: Автоматическая регистрация ваших обработчиков просмотра, эскизов, обработчиков свойств, правил брандмауэра, флагов URL.

:heavy_check_mark: Автоматическая регистрация сопоставлений типов файлов, которые позволяют пользователям группировать файлы с помощью столбца **Вид** в проводнике.

:heavy_check_mark: Регистрация ваших общедоступных COM-серверов.

**Юбилейное обновление Windows 10 или более поздняя версия**

:heavy_check_mark: Автоматическое подписывание пакета, чтобы вы могли протестировать ваше приложение.

:heavy_check_mark: Проверка приложения на соответствие требованиям для упакованных приложений и Microsoft Store.

Полный список параметров см. в разделе [Параметры](#command-reference) данного руководства.

Если вы готовы приступить к созданию пакета, давайте начнем.

## <a name="first-prepare-your-application"></a>Сначала подготовьте свое приложение

Прежде чем приступить к созданию пакета для приложения, ознакомьтесь с этим руководством. [Подготовка к упаковке классического приложения](desktop-to-uwp-prepare.md).

## <a name="make-sure-that-your-system-can-run-the-converter"></a>Системные требования для преобразователя

Убедитесь, что ваша система соответствует следующим требованиям:

* Юбилейное обновление Windows 10 Pro или Корпоративная (10.0.14393.0 и более поздней версии).
* 64-разрядный процессор (x64)
* Аппаратная виртуализация
* Преобразование адресов второго уровня (SLAT)
* [Пакет средств разработки программного обеспечения (SDK) для Windows 10](https://go.microsoft.com/fwlink/?linkid=821375).

## <a name="start-the-desktop-app-converter"></a>Запуск Desktop App Converter

1. Скачайте и установите [Desktop App Converter](https://aka.ms/converter).

2. Запустите Desktop App Converter от имени администратора.

    ![запуск DAC от имени администратора](images/run-converter.png)

   Откроется окно консоли. Оно будет использоваться для выполнения команд.

## <a name="set-a-few-things-up-apps-with-installers-only"></a>Настройка нескольких параметров (только для приложений с установщиками)

Если у приложения нет установщика, можно перейти к следующему разделу.

1. Определите номер версии вашей операционной системы.

   Для этого введите **winver** в диалоговом окне **Выполнить**, а затем нажмите **ОК**.

   ![winver](images/winver.png)

   Вы найдете версию сборки Windows в диалоговом окне **О Windows**.

   ![Версия Windows 10](images/win-10-version.png)

2. Скачайте подходящий [базовый образ Desktop app Converter](https://aka.ms/converterimages).

   Убедитесь, что номер версии, указанный в имени файла, соответствует номеру версии вашей сборки Windows.

   >[!IMPORTANT]
   > Если вы используете номер сборки **15063**и дополнительный номер версии сборки равен или больше **. 483** (например: **15063,540**) убедитесь, что скачан файл **басеимаже-15063-упдате. wim** . Если дополнительный номер версии этой сборки меньше **.483**, скачайте файл **BaseImage-15063.wim**. Если вы уже установили несовместимую версию этого базового файла, это можно исправить. В этой [записи в блоге](https://blogs.msdn.microsoft.com/appconsult/2017/08/04/desktop-app-converter-fails-on-windows-10-15063-483-and-later-how-to-solve-it/) объясняется, как это сделать.

3. Поместите скачанный файл в любое расположение на вашем компьютере, где вы сможете найти его в дальнейшем.

4. В окне консоли, которое появилось при запуске Desktop App Converter, выполните следующую команду: ```Set-ExecutionPolicy bypass```.
5. Настройте преобразователь, выполнив следующую команду: ```DesktopAppConverter.exe -Setup -BaseImage .\BaseImage-1XXXX.wim -Verbose```.
6. Перезапустите компьютер при появлении соответствующего запроса.

   По мере развертывания базового образа в окне консоли будут появляться сообщения о состоянии. Если вы не видите эти сообщения, нажмите любую клавишу. Это может привести к обновлению содержимого в окне консоли.

   ![сообщения о состоянии в окне консоли](images/bas-image-setup.png)

   Когда базовый образ будет полностью развернут, перейдите к следующему разделу.

## <a name="package-an-app"></a>Упаковка приложения

Для упаковки вашего приложения выполните команду ``DesktopAppConverter.exe`` в окне консоли, открываемой при запуске Desktop App Converter.  

Укажите имя пакета, издателя и номер версии приложения с помощью параметров.

> [!NOTE]
> Если вы зарезервированы имя приложения в Microsoft Store, вы можете получить имена пакетов и издателей с помощью [центра партнеров](https://partner.microsoft.com/dashboard). Если планируется, что приложение будет загружено на другие системы в неопубликованном виде, вы можете указать для этих атрибутов собственные имена при условии, что имя издателя совпадает с именем, указанным в сертификате, который используется для подписания приложения.

### <a name="a-quick-look-at-command-parameters"></a>Краткий обзор параметров команды

Вот список необходимых параметров:

```CMD
DesktopAppConverter.exe
-Installer <String>
-Destination <String>
-PackageName <String>
-Publisher <String>
-Version <Version>
```
Вы можете прочитать о каждом из них [здесь](#command-reference).

### <a name="examples"></a>Примеры

Вот несколько распространенных способов упаковки приложения.

* [Упаковка приложения с файлом установщика (MSI)](#installer-conversion)
* [Упаковка приложения с исполняемым файлом программы установки](#setup-conversion)
* [Упаковка приложения без установщика](#no-installer-conversion)
* [Упаковка приложения, Подписывание приложения и подготовка к отправке хранилища](#optional-parameters)

<a id="installer-conversion" />

#### <a name="package-an-application-that-has-an-installer-msi-file"></a>Упаковка приложения с файлом установщика (MSI)

Укажите файл установщика с помощью параметра ``Installer``.

```cmd
DesktopAppConverter.exe -Installer C:\Installer\MyAppSetup.msi -Destination C:\Output\MyApp -PackageName "MyApp" -Publisher "CN=MyPublisher" -Version 0.0.0.1
```

> [!IMPORTANT]
> Существует два важных аспекта, о которых следует помнить. Во-первых, убедитесь, что ваш установщик находится в независимой папке и что в ней размещаются только файлы, связанные с этим установщиком. Преобразователь копирует все содержимое этой папки в изолированную среду Windows. <br> Во-вторых, если центр партнеров назначает удостоверение для пакета, которое начинается с номера, убедитесь, что вы также передаете параметр <i>-AppID</i> и используете только суффикс строки (после разделителя точки) в качестве значения этого параметра.  

Если ваш установщик включает установщики для зависимых библиотек или платформ, возможно, потребуется организовать все несколько иначе. См. раздел [Объединение нескольких установщиков в цепочку с помощью моста для классических приложений](https://blogs.msdn.microsoft.com/appconsult/2017/09/11/chaining-multiple-installers-with-the-desktop-app-converter/).

<a id="setup-conversion" />

#### <a name="package-an-application-that-has-a-setup-executable-file"></a>Упаковка приложения с исполняемым файлом программы установки

Укажите исполняемый файл установки с помощью параметра ``Installer``.

```cmd
DesktopAppConverter.exe -Installer C:\Installer\MyAppSetup.exe -InstallerArguments "/S" -Destination C:\Output\MyApp -PackageName "MyApp" -Publisher "CN=MyPublisher" -Version 0.0.0.1
```

>[!IMPORTANT]
>Если центр партнеров назначает удостоверению пакета, который начинается с номера, убедитесь, что вы также передаете параметр <i>-AppID</i> и используете только суффикс строки (после разделителя точки) в качестве значения этого параметра.

Параметр ``InstallerArguments`` является необязательным. Однако, поскольку преобразователь приложений для настольных систем требует, чтобы установщик выполнялся в автоматическом режиме, может потребоваться использовать его, если приложению требуются автоматические флаги для автоматического запуска. Флаг ``/S`` — очень распространенный флаг автоматического режима, однако ваш флаг может отличаться в зависимости от того, какие технологии вы использовали для создания файла установки.

<a id="no-installer-conversion" />

#### <a name="package-an-application-that-doesnt-have-an-installer"></a>Упаковка приложения без установщика

В этом примере используйте ``Installer`` параметр, чтобы указать корневую папку файлов приложения.

Используйте параметр `AppExecutable`, чтобы указать исполняемый файл приложения.

```cmd
DesktopAppConverter.exe -Installer C:\Installer\MyApp\ -AppExecutable MyApp.exe -Destination C:\Output\MyApp -PackageName "MyApp" -Publisher "CN=MyPublisher" -Version 0.0.0.1
```

>[!IMPORTANT]
>Если центр партнеров назначает удостоверению пакета, который начинается с номера, убедитесь, что вы также передаете параметр <i>-AppID</i> и используете только суффикс строки (после разделителя точки) в качестве значения этого параметра.

<a id="optional-parameters" />

#### <a name="package-an-app-sign-the-app-and-run-validation-checks-on-the-package"></a>Упаковка и подписание приложения, а также запуск проверочных тестов для пакета

Этот пример похож на первый, за исключением того, как можно подписать приложение для локального тестирования, а затем проверить приложение на соответствие требованиям упакованного приложения и Microsoft Store.

```cmd
DesktopAppConverter.exe -Installer C:\Installer\MyAppSetup.exe -InstallerArguments "/S" -Destination C:\Output\MyApp -PackageName "MyApp" -Publisher "CN=MyPublisher" -Version 0.0.0.1 -MakeAppx -Sign -Verbose -Verify
```
>[!IMPORTANT]
>Если центр партнеров назначает удостоверению пакета, который начинается с номера, убедитесь, что вы также передаете параметр <i>-AppID</i> и используете только суффикс строки (после разделителя точки) в качестве значения этого параметра.

``Sign`` Параметр создает сертификат, а затем подписывает свое приложение. Для запуска приложения вам придется установить этот сертификат. Дополнительные сведения см. в разделе [Запуск упакованного приложения](#run-app) данного руководства.

Вы можете проверить приложение с помощью ``Verify`` параметра.

### <a name="a-quick-look-at-optional-parameters"></a>Краткий обзор необязательных параметров

Параметры ``Sign`` и ``Verify`` являются необязательными. Существуют и другие необязательные параметры.  Вот некоторые из наиболее часто используемых:

```CMD
[-ExpandedBaseImage <String>]
[-AppExecutable <String>]
[-AppFileTypes <String>]
[-AppId <String>]
[-AppDisplayName <String>]
[-AppDescription <String>]
[-PackageDisplayName <String>]
[-PackagePublisherDisplayName <String>]
[-MakeAppx]
[-LogFile <String>]
[<CommonParameters>]
```
Вы можете прочитать о них в следующем разделе.

<a id="command-reference" />

### <a name="parameter-reference"></a>Справка по параметрам

Ниже приведен полный список параметров (упорядоченных по категориям), которые можно использовать при запуске Desktop App Converter.

* [Установка](#setup-params)
* [Образовывать](#conversion-params)
* [Удостоверение пакета](#identity-params)
* [Манифест пакета](#manifest-params)
* [Чистку](#cleanup-params)
* [Архитектура](#architecture-params)
* [Прочее](#other-params)

Чтобы просмотреть весь список, можно также выполнить в окне консоли команду ``Get-Help``.   

||||
|-------------|-----------|-------------|
|<a id="setup-params" /><strong>Параметры установки</strong>  ||
|-Setup [&lt;параметр-переключатель&gt;] |Обязательно |Запускает DesktopAppConverter в режиме установки. Режим установки поддерживает развертывание предоставляемого базового образа.|
|-BaseImage &lt;String&gt; | Обязательно |Полный путь к неразвернутому базовому образу. Этот параметр необходим, если указана программа установки.|
| -LogFile &lt;String&gt; |Необязательный |Определяет файл журнала. Если этот параметр пропущен, для файла журнала будет создано временное расположение.|
|-NatSubnetPrefix &lt;String&gt; |Необязательный |Значение префикса, которое необходимо использовать для экземпляра Nat. Как правило, это значение будет необходимо изменить, только если ваш хост-компьютер подключен к тому же диапазону адресов подсети, что и NetNat преобразователя. Вы можете запросить текущую конфигурацию NetNat преобразователя, используя командлет **Get-NetNat**. |
|-NoRestart [&lt;параметр-переключатель&gt;] |Обязательно |Подавляет вывод запроса на перезагрузку при выполнении программы установки (перезагрузка необходима для включения функции контейнеров). |
|<a id="conversion-params" /><strong>Параметры преобразования</strong>|||
|-AppInstallPath &lt;String&gt;  |Необязательный |Полный путь к корневой папке вашего приложения для установленных файлов, если они были установлены (например, «C:\Program Files (x86)\MyApp»).|
|-Destination &lt;String&gt; |Обязательно |Желаемое расположение создаваемого преобразователем пакета AppX. DesktopAppConverter может создать это расположение, если оно еще не существует.|
|-Installer &lt;String&gt; |Обязательно |Путь к программе установки вашего приложения, которая должна поддерживать выполнение в автоматическом (тихом) режиме. Без установщика — это путь к корневому каталогу файлов приложения. |
|-InstallerArguments &lt;String&gt; |Необязательный |Список с разделителями-запятыми или строка аргументов, чтобы перевести выполнение программы установки в автоматический режим. Этот параметр необязателен, если вы используете программу установки msi. Для получения журнала из программы установки укажите в этом месте аргумент журнала для программы установки и используйте путь &lt;папка_журнала&gt;, являющийся маркером, который преобразователь заменит соответствующим путем. <br><br>**ПРИМЕЧАНИЕ**. Флаги автоматической или автоматической установки и аргументы журнала будут отличаться в разных технологиях установщика. <br><br>Пример использования этого параметра:-инсталлераргументс "/Silent/log &lt;log_folder&gt;\инсталл.лог". другой пример, который не создает файл журнала, может выглядеть следующим образом: ```-InstallerArguments "/quiet", "/norestart"```Опять же, необходимо напрямую направить все журналы в путь &lt;маркера log_folder&gt; , если необходимо, чтобы преобразователь захватывает его и поместил его в последнюю папку журнала.|
|-InstallerValidExitCodes &lt;Int32&gt; |Необязательный |Разделенный запятыми список кодов выхода, указывающих на успешное выполнение установщика (например: 0, 1234, 5678).  По умолчанию это 0 для программ установки, отличных от MSI, и 0, 1641, 3010 для программ установки MSI.|
|-MakeAppx [&lt;параметр-переключатель&gt;]  |Необязательный |Переключатель, который при его наличии, сообщает этому сценарию, что MakeAppx должен вызвать выходные данные. |
|-Макемсикс [&lt;переключатель&gt;]  |Необязательный |Переключатель, который при его наличии сообщает этому скрипту о необходимости упаковать выходные данные в пакет MSIX. |
|<a id="identity-params" /><strong>Параметры удостоверений пакета</strong>||
|-PackageName &lt;String&gt; |Обязательно |Имя пакета вашего универсального приложения для Windows. Если центр партнеров назначает удостоверению пакета, который начинается с номера, убедитесь, что вы также передаете параметр <i>-AppID</i> и используете только суффикс строки (после разделителя точки) в качестве значения этого параметра. |
|-Publisher &lt;String&gt; |Обязательно |Издатель вашего пакета универсального приложения для Windows |
|-Version &lt;Version&gt; |Обязательно |Номер версии вашего пакета универсального приложения для Windows |
|<a id="manifest-params" /><strong>Параметры манифеста пакета</strong>||
|-AppExecutable &lt;String&gt; |Необязательный |Имя основного исполняемого файла вашего приложения (например, "MyApp.exe"). Этот параметр является обязательным для преобразования приложений, не имеющих установщика. |
|-AppFileTypes &lt;String&gt;|Необязательный |Список типов файлов, с которыми будет связано приложение. Типы файлов должны отделяться друг от друга запятыми. Пример использования: -AppFileTypes "'.md', '.markdown'".|
|-AppId &lt;String&gt; |Необязательный |Указывает значение, которое нужно задать идентификатору приложения в манифесте пакета приложения для Windows. Если параметр не настроен, ему будет задано значение, передаваемое для *PackageName*. Во многих случаях достаточно использовать *PackageName*. Однако, если центр партнеров назначает удостоверению пакета, который начинается с номера, убедитесь, что вы также передаете параметр <i>-AppID</i> и используете только суффикс строки (после разделителя точки) в качестве значения этого параметра. |
|-AppDisplayName &lt;String&gt;  |Необязательный |Указывает значение, которое нужно задать отображаемому имени приложения в манифесте пакета приложения для Windows. Если параметр не настроен, ему будет задано значение, передаваемое для *PackageName*. |
|-AppDescription &lt;String&gt; |Необязательный |Указывает значение, которое нужно задать описанию приложения в манифесте пакета приложения для Windows. Если параметр не настроен, ему будет задано значение, передаваемое для *PackageName*.|
|-PackageDisplayName &lt;String&gt; |Необязательный |Указывает значение, которое нужно задать отображаемому имени пакета в манифесте пакета приложения для Windows. Если параметр не настроен, ему будет задано значение, передаваемое для *PackageName*. |
|-PackagePublisherDisplayName &lt;String&gt; |Необязательный |Указывает значение, которое нужно задать отображаемому имени издателя пакета в манифесте пакета приложения для Windows. Если параметр не настроен, ему будет задано значение, передаваемое для *Publisher*. |
|<a id="cleanup-params" /><strong>Параметры очистки</strong>|||
|-Cleanup [&lt;опция&gt;] |Обязательно |Запускает очистку артефактов DesktopAppConverter. Есть 3 допустимых варианта режима отчистки. |
|-Cleanup All | |Удаляет все развернутые базовые образы, удаляет все временные файлы преобразователя, удаляет контейнерную сеть и отключает необязательную функцию Windows — "Контейнеры". |
|-Cleanup WorkDirectory |Обязательно |Удаляет все временные файлы преобразователя. |
|-Cleanup ExpandedImage |Обязательно |Удаляет все развернутые базовые образы, установленные на хост-компьютере. |
|<a id="architecture-params" /><strong>Параметры архитектуры пакета</strong>|||
|-PackageArch &lt;String&gt; |Обязательно |Создает пакет с выбранной архитектурой. Допустимые типы архитектуры: "x86" или "x64"; например — PackageArch x86. Это необязательный параметр. Если не выбрать тип архитектуры пакета, DesktopAppConverter попытается определить ее автоматически. Если автоматически определить архитектуру не удается, будет использоваться архитектура пакета по умолчанию — x64. |
|<a id="other-params" /><strong>Прочие параметры</strong>|||
|-ExpandedBaseImage &lt;String&gt;  |Необязательный |Полный путь к уже развернутому базовому образу.|
|-LogFile &lt;String&gt;  |Необязательный |Определяет файл журнала. Если этот параметр пропущен, для файла журнала будет создано временное расположение. |
| -Sign [&lt;параметр-переключатель&gt;] |Необязательный |Сообщает этому сценарию, что требуется подписать выходной пакет приложения для Windows, используя созданный сертификат, для тестирования. Этот параметр следует использовать вместе с параметром ```-MakeAppx```. |
|&lt;Общие параметры&gt; |Обязательно |Этот командлет поддерживает общие параметры: *Verbose*, *Debug*, *ErrorAction*, *ErrorVariable*, *WarningAction*, *WarningVariable*, *buffer*, *PipelineVariable*и *variable*. Дополнительные сведения см. в разделе [about_CommonParameters](https://go.microsoft.com/fwlink/?LinkID=113216). |
| -Verify [&lt;параметр-переключатель&gt;] |Необязательный |Переключатель, который при его наличии указывает приложению уровня данных проверить пакет приложения на соответствие требованиям к упакованным приложениям и Microsoft Store. Результат — отчет о проверке "VerifyReport.xml", который лучше всего отображается в браузере. Этот параметр следует использовать вместе с параметром `-MakeAppx`. |
|-PublishComRegistrations| Необязательный| Сканирует все общедоступные регистрации COM, выполненные вашим установщиком, и публикует в манифесте те из них, которые являются допустимыми. Используйте этот флаг, только если хотите, чтобы эти регистрации стали доступны для других приложений. Не указывайте данный флаг, если эти регистрации будут использоваться только вашим приложением. <br><br>Ознакомьтесь с [этим разделом](https://blogs.windows.com/buildingapps/2017/04/13/com-server-ole-document-support-desktop-bridge/#lDg5gSFxJ2TDlpC6.97), чтобы убедиться, что поведение ваших регистраций COM после упаковки приложения соответствует ожидаемому.

<a id="run-app" />

## <a name="run-the-packaged-app"></a>Запуск упакованного приложения

Существует два способа запуска вашего приложения.

Первый — открыть командную строку PowerShell, а затем ввести следующую команду: ```Add-AppxPackage –Register AppxManifest.xml```. Возможно, это самый простой способ запустить приложение, так как вам не нужно подписывать его.

Другой способ — подписать приложение с помощью сертификата. Если вы используете ```sign``` параметр, преобразователь приложений для настольных систем создаст его, а затем подпишет приложение с помощью. Этот файл называется **auto-generated.cer** и находится в корневой папке вашего упакованного приложения.

Чтобы установить созданный сертификат и запустить приложение, выполните следующие действия:

1. Дважды щелкните файл **auto-generated.cer**, чтобы установить этот сертификат.

   ![созданный файл сертификата](images/generated-cert-file.png)

   > [!NOTE]
   > При появлении запроса пароля используйте пароль по умолчанию "123456".

2. В диалоговом окне **Сертификат** нажмите кнопку **Установить сертификат**.
3. В окне **Мастер импорта сертификатов** установите сертификат на **Локальный компьютер**, а затем поместите в хранилище сертификатов **Доверенные лица**.

   ![Хранилище "Доверенные лица"](images/trusted-people-store.png)

5. В корневой папке упакованного приложения дважды щелкните файл пакета приложения для Windows.

   ![Файл пакета приложения для Windows](images/windows-app-package.png)

6. Установите приложение, нажав кнопку **Установить**.

   ![Кнопка "Установить"](images/install.png)


## <a name="modify-the-packaged-app"></a>Изменение упакованного приложения

Вы, скорее всего, внесете изменения в упакованное приложение для устранения ошибок, добавления визуальных ресурсов или расширения возможностей приложения с помощью современных плиток, таких как динамические плитки.

После внесения изменений запускать преобразователь повторно не требуется. В большинстве случаев можно просто переупаковать приложение с помощью средства программе makeappx и файла appxmanifest. XML, который создается приложением уровня данных для вашего приложения. См. раздел [Создание пакета приложений для Windows](desktop-to-uwp-manual-conversion.md#make-appx).

* Если вы изменили какие-либо визуальные ресурсы вашего приложения, создайте новый файл индекса ресурсов пакета и запустите средство MakeAppx, чтобы создать новый пакет. См. [Создание файла индекса ресурсов пакета (PRI)](desktop-to-uwp-manual-conversion.md#make-pri).

* Если вы хотите добавить значки или плитки, которые отображаются на панели задач Windows, в представлении задач, в окне, вызываемом сочетанием клавиш ALT+TAB, в Snap Assist и в правом нижнем углу плиток начального экрана, см. раздел [Добавление специальных ресурсов без покрытия (необязательно)](desktop-to-uwp-manual-conversion.md#target-based-assets).

> [!NOTE]
> Если вы изменили параметры реестра, заданные вашим установщиков, необходимо повторно запустить Desktop App Converter, чтобы восстановить эти изменения.

В следующих двух разделах описывается несколько необязательных исправлений для упакованного приложения, которое можно рассматривать.

### <a name="delete-unnecessary-files-and-registry-keys"></a>Удаление ненужных файлов и разделов реестра

Desktop App Converter использует очень консервативный подход к фильтрации файлов и системного шума в контейнере.

При желании можно просмотреть папку VFS и удалить все файлы, которые не требуются вашему установщику.  Кроме того, вы можете просмотреть содержимое файла Reg.dat и удалить все разделы, которые не установлены или не требуются вашему приложению.

### <a name="fix-corrupted-pe-headers"></a>Исправление поврежденных PE-заголовков

В процессе преобразования DesktopAppConverter автоматически запускает PEHeaderCertFixTool, чтобы исправить все поврежденные PE-заголовки. Но вы также можете запустить PEHeaderCertFixTool для пакета приложения UWP для Windows, свободных файлов или определенного двоичного файла. Рассмотрим пример.

```CMD
PEHeaderCertFixTool.exe <binary file>|<.appx package>|<folder> [/c] [/v]
 /c   -- check for corrupted certificate but do not fix (optional)
 /v   -- verbose (optional)
example1: PEHeaderCertFixTool app.exe
example2: PEHeaderCertFixTool c:\package.appx /c
example3: PEHeaderCertFixTool c:\myapp /c /v
```

## <a name="telemetry-from-desktop-app-converter"></a>Телеметрия Desktop App Converter

Desktop App Converter может собирать сведения о вас и об используемом вами программном обеспечении и отправлять эти данные в Майкрософт. Подробнее о процессе сбора данных корпорацией Майкрософт и их использовании в документации по продуктам см. в [заявлении о конфиденциальности корпорации Майкрософт](https://go.microsoft.com/fwlink/?LinkId=521839). Вы соглашаетесь выполнять требования всех применимых положений заявления о конфиденциальности корпорации Майкрософт.

По умолчанию для Desktop App Converter телеметрия будет включена. Добавьте следующий раздел реестра для настройки телеметрии:  

```cmd
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\DesktopAppConverter
```
+ Добавьте или измените значение *DisableTelemetry* с помощью DWORD со значением 1.
+ Для включения телеметрии удалите раздел или задайте значение 0.

### <a name="language-support"></a>Языковая поддержка

Desktop App Converter не поддерживает Юникод, поэтому в нем нельзя использовать символы китайского языка или символы, отличные от набора ASCII.

## <a name="known-issues-with-the-desktop-app-converter"></a>Известные проблемы с преобразовательом классических приложений

### <a name="ecreatingisolatedenvfailed-an-estartingisolatedenvfailed-errors"></a>Ошибки E_CREATING_ISOLATED_ENV_FAILED и E_STARTING_ISOLATED_ENV_FAILED    

Если вы получили какую-либо из этих ошибок, убедитесь, что вы используете правильный базовый образ из [центра загрузки](https://aka.ms/converterimages).
Если вы используете правильный базовый образ, попробуйте выполнить команду ``-Cleanup All``.
Если это не поможет устранить проблему, отправьте ваши журналы по адресу converter@microsoft.com, чтобы мы могли их изучить.

### <a name="new-containernetwork-the-object-already-exists-error"></a>New-ContainerNetwork: Объект уже существует. ошибка

Эта ошибка может возникнуть при установке нового базового образа. Это происходит, если на вашем компьютере для разработки, на котором ранее был установлен Desktop App Converter, есть тестируемая возможность, предназначенная для участников программы предварительной оценки Windows.

Чтобы решить эту проблему, попробуйте выполнить команду `Netsh int ipv4 reset` из командной строки с повышенными привилегиями, а затем перезагрузите компьютер.

### <a name="your-net-application-is-compiled-with-the-anycpu-build-option-and-fails-to-install"></a>Приложение .NET компилируется с параметром сборки "AnyCPU" и не устанавливается

Это может произойти, если главный исполняемый файл или некая зависимость были размещены где-то в иерархии папок **Program Files** или **Windows\System32**.

Чтобы решить эту проблему, попробуйте использовать установщик рабочего стола определенной архитектуры (32-разрядный или 64-разрядный), чтобы создать пакет приложения для Windows.

### <a name="publishing-public-side-by-side-fusion-assemblies-wont-work"></a>Публикация общедоступных параллельных сборок Fusion будет невозможна.

 В ходе процесса установки приложение может публиковать располагающиеся рядом друг с другом общедоступные сборки Fusion, которые являются доступными для любого другого процесса. Во время создания контекста активации процесса эти сборки извлекаются системным процессом с именем CSRSS.exe. Когда эта процедура выполняется для преобразованного процесса, будет происходить сбой процессов создания контекста активации и загрузки модулей этих сборок. Параллельные сборки Fusion регистрируются в следующих местах:
  + Реестра`HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\SideBySide\Winners`
  + Файловая система:% WINDIR\\% сидебисиде

Это известное ограничение, и в настоящее время решения этой проблемы не существует. Несмотря на сказанное, входящие сборки, такие как ComCtl, поставляются вместе с операционной системой, поэтому указание зависимости от них является безопасным.

### <a name="error-found-in-xml-the-executable-attribute-is-invalid---the-value-myappexe-is-invalid-according-to-its-datatype"></a>В XML обнаружена ошибка. Атрибут "Executable" недействителен: значение "MyApp.EXE" недействительно с точки зрения его типа данных

Эта проблема может произойти, если исполняемые файлы в вашем приложении имеют расширение **. EXE**, написанное прописными буквами. Несмотря на то, что регистр этого расширения не должен влиять на работу приложения, это может привести к возникновению этой ошибки в приложении уровня данных.

Чтобы устранить эту проблему, попробуйте указать флаг **-аппексекутабле** при упаковке и используйте нижний регистр ". exe" в качестве расширения основного исполняемого файла (например: MYAPP. exe).    Кроме того, можно изменить регистр для всех исполняемых файлов в приложении с нижнего регистра на верхний (например: из. EXE в. exe).

### <a name="corrupted-or-malformed-authenticode-signatures"></a>Поврежденные или деформированные подписи Authenticode

Этот раздел содержит инструкции по выявлению проблем с переносными исполняемыми файлами (PE) в пакете приложения для Windows, который может содержать поврежденные или деформированные подписи Authenticode. Наличие недействительных подписей Authenticode в файлах PE, которые могут иметь любой двоичный формат (например, .exe, .dll, .chm и т. д.), приведет к тому, что вы не сможете правильно подписать пакет и, таким образом, не сможете развернуть его из пакета приложения для Windows.

Расположение подписи Authenticode файла PE определяется записью в таблице сертификатов в каталогах данных необязательных заголовков и соответствующей таблице сертификатов атрибутов. Во время проверки подписи сведения, указанные в этих местах, используются для поиска подписи на файле PE. При повреждении этих значений процесс подписывания файла может быть выполнен некорректно.

Чтобы подпись Authenticode была правильной, применительно к ней должны быть выполнены следующие условия:

- Начало записи **WIN_CERTIFICATE** в файле PE не должно выходить за границу исполняемого файла.
- Запись **WIN_CERTIFCATE** должна размещаться в конце образа.
- Размер записи **WIN_CERTIFICATE** должен быть положительным.
- Запись **WIN_CERTIFICATE** должна начинаться после структуры **IMAGE_NT_HEADERS32** для 32-разрядных исполняемых файлов и после структуры IMAGE_NT_HEADERS64 для 64-разрядных исполняемых файлов.

Дополнительные сведения см. в спецификациях [Формат подписи Authenticode Portal Executable](https://download.microsoft.com/download/9/c/5/9c5b2167-8017-4bae-9fde-d599bac8184a/Authenticode_PE.docx) и [Формат файла PE](https://msdn.microsoft.com/windows/hardware/gg463119.aspx).

Обратите внимание, что при попытке подписывания пакета приложения для Windows средство SignTool.exe может выводить информацию о поврежденных или деформированных двоичных файлах. Чтобы это сделать, включите регистрацию подробных сведений в журнале, задав переменной среды APPXSIP_LOG значение 1 (например, ```set APPXSIP_LOG=1``` ) и перезапустите средство SignTool.exe.

Чтобы исправить эти деформированные двоичные файлы, убедитесь, что они соответствуют требованиям выше.

## <a name="next-steps"></a>Следующие шаги

**Поиск ответов на вопросы**

Есть вопросы? Задайте их на Stack Overflow. Наша команда следит за этими [тегами](https://stackoverflow.com/questions/tagged/project-centennial+or+desktop-bridge). Вы также можете задать нам вопросы [здесь](https://social.msdn.microsoft.com/Forums/en-US/home?filter=alltypes&sort=relevancedesc&searchTerm=%5BDesktop%20Converter%5D).

**Отправьте отзыв или получите предложения по функциям**

См. раздел [UserVoice](https://wpdev.uservoice.com/forums/110705-universal-windows-platform/category/161895-desktop-bridge-centennial)

**Запуск приложения, Поиск и устранение проблем**

См. раздел [Запуск, отладка и тестирование приложения в упакованном классическом приложении](desktop-to-uwp-debug.md) .

**Распространение приложения**

См. раздел [распространение упакованного](/windows/apps/desktop/modernize/desktop-to-uwp-distribute) классического приложения.
