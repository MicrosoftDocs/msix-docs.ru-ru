---
title: Распространение приложения для Windows 10 с сервера IIS
description: В этом учебнике показано, как настроить сервер IIS, убедиться, что веб-приложение может размещать пакеты приложений, а также вызывать и использовать установщик приложений эффективно.
ms.date: 05/30/2018
ms.topic: article
keywords: Windows 10, UWP, установщик приложений, AppInstaller, загружать неопубликованные, связанный набор, дополнительные пакеты, сервер IIS
ms.localizationpriority: medium
ms.custom: RS5, seodec18
ms.openlocfilehash: 24a27f857ff8782d7a91817f2a5333b8ee87c104
ms.sourcegitcommit: 3a9aae783331833bbf244091544c48848768137e
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 01/08/2021
ms.locfileid: "98041155"
---
# <a name="distribute-a-windows-10-app-from-an-iis-server"></a>Распространение приложения для Windows 10 с сервера IIS

В этом учебнике показано, как настроить сервер IIS, убедиться, что веб-приложение может размещать пакеты приложений, а также вызывать и использовать установщик приложений эффективно.

Приложение "Установщик приложений" позволяет разработчикам и ИТ-специалистам распространять приложения Windows 10 путем их размещения в собственной сети доставки содержимого (CDN). Это полезно для предприятий, которым не требуется публиковать свои приложения в Microsoft Store, но они все же хотят воспользоваться преимуществами платформы упаковки и развертывания Windows 10. 

## <a name="setup"></a>Настройка

Для успешного работы с этим руководством вам потребуется следующее:

1. Visual Studio 2017  
2. Средства веб-разработки и IIS 
3. Пакет приложения Windows 10 — пакет приложения, который будет распространяться

Необязательно: [Стартовый проект](https://github.com/AppInstaller/MySampleWebApp) на GitHub. Это полезно, если у вас нет пакетов приложений для работы с, но по-прежнему требуется научиться использовать эту функцию.

## <a name="step-1---install-iis-and-aspnet"></a>Шаг 1. Установка IIS и ASP.NET 

[Службы IIS](https://www.iis.net/) — это компонент Windows, который можно установить с помощью меню "Пуск". В **меню "Пуск** " найдите пункт **Включение или отключение компонентов Windows**.

Найдите и выберите **службы IIS** , чтобы установить службы IIS.

> [!NOTE]
> Не нужно выбирать все флажки в разделе службы IIS. Достаточно выбрать только те из них, которые выбраны при проверке **службы IIS** .

Также потребуется установить ASP.NET 4,5 или более поздней версии. Чтобы установить его, выберите **службы IIS > веб-служб в интернете > функции разработки приложений**. Выберите версию ASP.NET, которая больше или равна ASP.NET 4,5.

![Снимок экрана: Установка компонента ASP.NET](images/install-asp.png)

## <a name="step-2---install-visual-studio-2017-and-web-development-tools"></a>Шаг 2. Установка Visual Studio 2017 и средств веб-разработки 

[Установите Visual Studio 2017](/visualstudio/install/install-visual-studio) , если он еще не установлен. Если у вас уже есть Visual Studio 2017, убедитесь, что установлены следующие рабочие нагрузки. Если рабочие нагрузки отсутствуют в вашей установке, следуйте указаниям в Visual Studio Installer (из меню "Пуск").  

Во время установки выберите **ASP.NET и веб-разработку** и другие необходимые рабочие нагрузки. 

После завершения установки запустите Visual Studio и создайте новый проект (**файл**  ->  **создать проект**).

## <a name="step-3---build-a-web-app"></a>Шаг 3. Создание веб-приложения

Запустите Visual Studio 2017 от имени **администратора** и создайте новый проект **веб-приложения Visual C#** с **пустым** шаблоном проекта. 

![Снимок экрана создания нового веб-проекта](images/sample-web-app.png)

## <a name="step-4---configure-iis-with-our-web-app"></a>Шаг 4. Настройка служб IIS с помощью нашего веб-приложения 

В обозреватель решений щелкните правой кнопкой мыши корневой проект и выберите пункт **Свойства**.

В свойствах веб-приложения перейдите на вкладку **веб** . В разделе **серверы** выберите пункт **локальные службы IIS** в раскрывающемся меню и щелкните **создать виртуальный каталог**. 

![Снимок экрана: вкладка "веб" в свойствах проекта](images/web-tab.png)

## <a name="step-5---add-an-app-package-to-a-web-application"></a>Шаг 5. Добавление пакета приложения в веб-приложение 

Добавьте пакет приложения, который будет распространяться в веб-приложение. Вы можете использовать пакет приложения, который входит в состав предоставленных [пакетов начального проекта](https://github.com/AppInstaller/MySampleWebApp/tree/master/MySampleWebApp/packages) на сайте GitHub, если у вас нет пакета приложений. Сертификат (MySampleApp.cer), с помощью которого был подписан пакет, также входит в состав примера на GitHub. Сертификат должен быть установлен на устройстве до установки приложения (шаг 9).

В веб-приложении начального проекта в веб-приложение была добавлена новая папка **, которая содержит пакеты приложений** для распространения. Чтобы создать папку в Visual Studio, щелкните правой кнопкой мыши узел проекта в Обозреватель решений, выберите команду **Добавить**  ->  **новую папку** и назовите ее **пакеты**. Чтобы добавить пакеты приложений в папку, щелкните правой кнопкой мыши папку **пакеты** и выберите **Добавить**  ->  **существующий элемент...** и перейдите к расположению пакета приложения. 

![Снимок экрана: Добавление пакета](images/add-package.png)

## <a name="step-6---create-a-web-page"></a>Шаг 6. Создание веб-страницы

В этом примере веб-приложения используется простой HTML. Вы можете создавать веб-приложения по мере необходимости в соответствии с вашими потребностями. 

Щелкните правой кнопкой мыши корневой проект обозревателя решений, выберите **Добавить**  ->  **новый элемент** и добавьте новую **HTML-страницу** из раздела **веб** .

После создания HTML-страницы щелкните правой кнопкой мыши страницу HTML в обозреватель решений и выберите **задать в качестве начальной страницы**.  

Дважды щелкните HTML-файл, чтобы открыть его в окне редактора кода. В этом руководстве для успешной установки приложения Windows 10 будет использоваться только один из элементов в, обязательных на веб-странице, для вызова приложения установщика приложений. 

Включите следующий код HTML на веб-страницу. Ключом к успешному вызову установщика приложений является использование пользовательской схемы, которую установщик приложения регистрирует в операционной системе: `ms-appinstaller:?source=` . Дополнительные сведения см. в приведенном ниже примере кода.

> [!NOTE]
> Убедитесь, что URL-адрес, указанный после настраиваемой схемы, соответствует URL-адресу проекта на вкладке "веб" в решении VS.
 
```HTML
<html>
<head>
    <meta charset="utf-8" />
    <title> Install Page </title>
</head>
<body>
    <a href="ms-appinstaller:?source=http://localhost/SampleWebApp/packages/MySampleApp.msixbundle"> Install My Sample App</a>
</body>
</html>
```

## <a name="step-7---configure-the-web-app-for-app-package-mime-types"></a>Шаг 7. Настройка веб-приложения для типов MIME для пакета приложения

Откройте файл **Web.config** в обозревателе решений и добавьте в элемент следующие строки `<configuration>` . 

```xml
<system.webServer>
    <!--This is to allow the web server to serve resources with the appropriate file extension-->
    <staticContent>
      <mimeMap fileExtension=".appx" mimeType="application/appx" />
      <mimeMap fileExtension=".msix" mimeType="application/msix" />
      <mimeMap fileExtension=".appxbundle" mimeType="application/appxbundle" />
      <mimeMap fileExtension=".msixbundle" mimeType="application/msixbundle" />
      <mimeMap fileExtension=".appinstaller" mimeType="application/appinstaller" />
    </staticContent>
</system.webServer>
```

> [!NOTE]
> Новейшие веб-технологии корпорации Майкрософт .Net Core. Сборка веб-сайта с использованием .Net Core ASP Ignore web.config статического содержимого mimeMap. В результате, чтобы правильно настроить .Net Core веб-сайта, где будет размещена установка MSIX, необходимо изменить метод configure в файле Startup.cs.

## <a name="step-8---add-loopback-exemption-for-app-installer"></a>Шаг 8. Добавление исключения замыкания на себя для установщика приложений

Из-за сетевой изоляции приложения Windows 10, такие как установщик приложений, могут использовать IP-адреса замыкания на себя, такие как http://localhost/ . При использовании локального сервера IIS установщик приложения необходимо добавить в список исключений замыкания на себя. 

Для этого откройте **командную строку** от имени **администратора** и введите следующее:
```Command Line
CheckNetIsolation.exe LoopbackExempt -a -n=microsoft.desktopappinstaller_8wekyb3d8bbwe
```

Чтобы убедиться, что приложение Добавлено в список исключений, используйте следующую команду, чтобы отобразить приложения в списке исключений замыкания на себя: 
```Command Line
CheckNetIsolation.exe LoopbackExempt -s
```

Вы должны найти `microsoft.desktopappinstaller_8wekyb3d8bbwe` в списке.

После завершения локальной проверки установки приложения с помощью установщика приложений можно удалить исключение замыкания на себя, добавленное на этом шаге:

```Command Line
CheckNetIsolation.exe LoopbackExempt -d -n=microsoft.desktopappinstaller_8wekyb3d8bbwe
```

## <a name="step-9---run-the-web-app"></a>Шаг 9. Запуск веб-приложения 

Создайте и запустите веб-приложение, нажав кнопку выполнить на ленте VS, как показано на рисунке ниже.

![Снимок экрана: работа веб-приложения в Visual Studio](images/run.png)

В браузере откроется веб-страница:

![Снимок экрана: Установка приложения из веб-страницы](images/web-page.png)

Щелкните ссылку на веб-странице, чтобы запустить приложение установщика приложений и установить пакет приложения Windows 10.


## <a name="troubleshooting-issues"></a>Устранение неполадок

### <a name="not-sufficient-privilege"></a>Недостаточно прав доступа 

Если при запуске веб-приложения в Visual Studio отображается сообщение об ошибке "у вас недостаточно прав для доступа к веб-сайтам IIS на вашем компьютере", необходимо запустить Visual Studio от имени администратора. Закройте текущий экземпляр Visual Studio и снова откройте его в качестве администратора.

### <a name="set-start-page"></a>Задать начальную страницу 

Если при запуске веб-приложения браузер загружается с ошибкой HTTP 403,14-запрещено, это означает, что веб-приложение не имеет определенной начальной страницы. См. шаг 6 в этом учебнике, чтобы узнать, как определить начальную страницу.
