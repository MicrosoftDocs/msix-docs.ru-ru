---
ms.assetid: 3a59ff5e-f491-491c-81b1-6aff15886aad
title: Разработка дополнительных пакетов и связанных наборов
description: Дополнительные пакеты включают в себя содержимое, которое можно интегрировать с главным пакетом. Они полезны для загрузки содержимого (DLC) и других сценариев.
ms.date: 07/02/2019
ms.topic: article
author: dianmsft
ms.author: diahar
keywords: Windows 10, msix, UWP, необязательные пакеты, связанный набор, расширение пакета, Visual Studio
ms.localizationpriority: medium
ms.openlocfilehash: c8b0dbc98e73e4086556fa6f169522ed5fcc37d9
ms.sourcegitcommit: f6bb9ced4cce853ae6acd3a359cbbb5e2e3f7187
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/26/2020
ms.locfileid: "85441661"
---
# <a name="optional-packages-and-related-set-authoring"></a>Разработка дополнительных пакетов и связанных наборов

Дополнительные пакеты включают в себя содержимое, которое можно интегрировать с главным пакетом. Они полезны для загружаемого контента (DLC), так как позволяют поделить большое приложение при наличии ограничений на размер или доставить любое дополнительное содержимое отдельно от исходного приложения.

Связанные наборы представляют собой расширение дополнительных пакетов. Они позволяют принудительно применять строгий набор версий для главного и дополнительных пакетов. Связанные наборы могут иметь разных издателей из основного приложения, если они развернуты за пределами магазина.

Необязательные пакеты и связанные наборы запускаются внутри контейнера MSIX основного приложения.

## <a name="prerequisites"></a>Предварительные требования

- Visual Studio 2019 или Visual Studio 2017 (версия 15,1 или более поздняя)
- Windows 10 версии 1703 или более поздней
- Windows 10, пакет SDK для версии 1703 или более поздней

Чтобы скачать все самые последние средства для разработки, см. раздел [Загружаемые файлы и инструменты для Windows 10](https://developer.microsoft.com/windows/downloads).

> [!NOTE]
> Чтобы отправить приложение, которое использует необязательные пакеты и/или связанные наборы для Microsoft Store, вам потребуется разрешение. Необязательные пакеты и связанные наборы можно использовать для бизнес-приложений или корпоративных приложения без разрешения центра партнеров, если они не отправлены в магазин. Для получения разрешения на отправку приложений, использующих дополнительные пакеты и связанные наборы, см. раздел [Поддержка разработчиков для Windows](https://developer.microsoft.com/windows/support).

## <a name="code-sample"></a>Пример кода

Во время чтения этой статьи рекомендуется следить за [примером кода для дополнительного пакета](https://github.com/AppInstaller/OptionalPackageSample) на GitHub, чтобы получить практическое понимание работы дополнительных пакетов и связанных наборов в Visual Studio.

## <a name="optional-packages"></a>Дополнительные пакеты

Чтобы создать дополнительный пакет в Visual Studio, необходимо выполнить следующее:
1. Убедитесь, что для параметра **Минимальная версия целевой платформы** приложения задано значение 10.0.15063.0 или выше.
2. Из проекта вашего **главного пакета** откройте файл `Package.appxmanifest`. Перейдите на вкладку "Упаковка" и обратите внимание на **имя семейства пакета**, в которое входят все символы до символа "_".
3. Из проекта вашего **дополнительного пакета** щелкните правой кнопкой мыши файл `Package.appxmanifest` и выберите пункты **Открыть с помощью > Редактор (текстовый) XML**.
4. Найдите в этом файле элемент `<Dependencies>`. Добавьте следующее и замените `[MainPackageDependency]` **именем семейства пакетов** , которое было на шаге 2. Эта строка будет указывать, что ваш **дополнительный пакет** зависит от **главного пакета**.
    ```XML
    <uap3:MainPackageDependency Name="[MainPackageDependency]"/>
    ```

После настройки зависимостей пакета из шагов с 1 по 4 можно продолжить разработку, как обычно. 

Visual Studio можно настроить для повторного развертывания главного пакета при каждом развертывании дополнительного пакета. Чтобы задать зависимости сборки в Visual Studio, выполните следующее:

1. Щелкните правой кнопкой мыши проект дополнительного пакета и выберите пункты **Зависимости сборки > Зависимости проекта...**
2. Выберите проект главного пакета и нажмите кнопку "ОК". 

Теперь каждый раз при нажатии клавиши F5 или сборке проекта дополнительного пакета программа Visual Studio будет создавать сначала проект главного пакета. Это гарантирует синхронизацию главного и дополнительного проектов.

## <a name="related-sets"></a>Связанные наборы<a name="related_sets"></a>

Связанный набор состоит из основного пакета и необязательного пакета, который тесно связан с помощью метаданных, указанных в файле. appxbundle или. msixbundle основного пакета. Эти метаданные связывают основной пакет с дополнительным пакетом (используя имя appxbundle-файла и версию) и дополнительный пакет для основного пакета (с использованием независимого от версии имени). Visual Studio помогает вам получить правильные метаданные в ваших файлах. 

Управление версиями пакетов в связанном наборе синхронизируется таким образом, что не позволит использовать последнюю версию любого пакета до тех пор, пока не будут установлены все связанные пакеты набора (указанные версией в основном пакете). Пакеты обслуживаются независимо, но пакеты, указанные в наборе, могут не использоваться до тех пор, пока не будут обновлены все.

Чтобы настроить решение для связанных наборов для вашего приложения, выполните следующие действия:

1. Щелкните правой кнопкой мыши проект главного пакета и выберите пункты **Добавить > Новый элемент...**
2. Из этого окна выполните поиск установленных шаблонов для ".txt" и добавьте новый текстовый файл.
    > [!IMPORTANT]
    > Новый текстовый файл должен называться `Bundle.Mapping.txt`.
3. В файле `Bundle.Mapping.txt` укажите относительные пути к любым проектам дополнительных пакетов или внешним пакетам. Образец файла `Bundle.Mapping.txt` должен выглядеть примерно так:
    ```syntax
    [OptionalProjects]
    "..\ActivatableOptionalPackage1\ActivatableOptionalPackage1.vcxproj"
    "..\ActivatableOptionalPackage2\ActivatableOptionalPackage2.vcxproj"

    [ExternalPackages]
    "..\ActivatableOptionalPackage1\x86\Release\ActivatableOptionalPackage3_1.1.1.0\ ActivatableOptionalPackage3_1.1.1.0.appx"
    ```

Если решение настроено таким образом, Visual Studio создаст [манифест пакета](https://docs.microsoft.com/uwp/schemas/bundlemanifestschema/bundle-manifest) с именем AppxBundleManifest.xml для основного пакета со всеми необходимыми метаданными для связанных наборов. 

Обратите внимание, что, как и в случае с дополнительными пакетами, `Bundle.Mapping.txt` файл для связанных наборов будет работать только в Windows 10, версии 1703 или более поздней. Кроме того, минимальная версия целевой платформы приложения должна быть равна 10.0.15063.0 или выше.

## <a name="removing-optional-packages"></a>Удаление дополнительных пакетов 
Пользователи могут войти в приложение **параметров** и удалить необязательные пакеты. Аналогичным образом разработчики могут использовать [ремовеоптионалпаккажеасинк](https://docs.microsoft.com/uwp/api/Windows.ApplicationModel.PackageCatalog) для удаления списка дополнительных пакетов. 

```csharp
PackageCatalog catalog = PackageCatalog.OpenForCurrentPackage();
List<string> optionalList = new List<string>();
optionalList.Add("FabrikamAgeAnalysis_kwpnjs8c36mz0");
    
// Warn user that application will be restarted. 
var result = await catalog.RemoveOptionalPackagesAsync(optionalList);
if (result.ExtendedError != null)
{
    throw removalResult.ExtendedError;
}
```
> [!NOTE]
> В случае связанного набора платформа должна перезапустить основное приложение, чтобы завершить удаление, чтобы избежать ситуаций, в которых приложение имеет содержимое, загруженное из удаляемого пакета. Приложения должны уведомлять пользователей о том, что приложение потребуется перезапустить, прежде чем приложение вызовет API.

Если дополнительный пакет является содержимым, то разработчик должен явно сообщить платформе, что удаляемый пакет не используется приложением, прежде чем разработчик удалит дополнительный пакет. Это также позволяет разработчику удалить пакет без перезагрузки.

## <a name="known-issues"></a>Известные проблемы<a name="known_issues"></a>

В настоящее время в Visual Studio не поддерживается отладка дополнительного проекта связанного набора. Чтобы обойти эту проблему, можно развернуть и запустить активацию (Ctrl+F5) и вручную подключить отладчик к процессу. Чтобы подключить отладчик, перейдите в Visual Studio в меню "Отладка", выберите пункт "Присоединиться к процессу..." и подключите отладчик к **процессу основного приложения**.
